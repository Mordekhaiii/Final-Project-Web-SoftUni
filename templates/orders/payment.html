{% extends 'orders/order_payment.html' %}
{% load static %}

{% block content %}
<div class="container payment-page">
    <div class="payment-header">
        <h1>Payment Confirmation</h1>
        <p>Order Reference: {{ order_reference }}</p>
    </div>

    <div class="order-summary">
        <h2>Order Summary</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>Rp {{ item.price|floatformat:2 }}</td>
                    <td>Rp {{ item.total|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3"><strong>Total</strong></td>
                    <td><strong>Rp {{ order.total_price|floatformat:2 }}</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="payment-methods">
        <h2>Choose Payment Method</h2>
        <div class="payment-options">
            <button class="btn btn-primary payment-method" data-method="transfer">Bank Transfer</button>
            <button class="btn btn-success payment-method" data-method="ewallet">E-Wallet</button>
            <button class="btn btn-info payment-method" data-method="cod">Cash on Delivery</button>
        </div>
    </div>

    <div class="payment-details" style="display: none;">
        <h3>Payment Details</h3>
        <div id="transfer-details" class="payment-method-details">
            <p>Bank Transfer to:</p>
            <p>Bank Name: BCA</p>
            <p>Account Number: 1234567890</p>
            <p>Account Name: Oey Alycia Resto & Cafe</p>
        </div>
        <div id="ewallet-details" class="payment-method-details">
            <p>E-Wallet Options:</p>
            <p>DANA: 081234567890</p>
            <p>OVO: 081234567890</p>
            <p>GoPay: 081234567890</p>
        </div>
        <div id="cod-details" class="payment-method-details">
            <p>Pay directly to our delivery driver</p>
        </div>
    </div>

    <div class="payment-confirmation">
        <button id="confirm-payment" class="btn btn-primary" disabled>Confirm Payment</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const paymentMethods = document.querySelectorAll('.payment-method');
    const paymentDetails = document.querySelector('.payment-details');
    const confirmPaymentBtn = document.getElementById('confirm-payment');

    paymentMethods.forEach(method => {
        method.addEventListener('click', function() {
            // Hide all payment method details
            document.querySelectorAll('.payment-method-details').forEach(detail => {
                detail.style.display = 'none';
            });

            // Show selected payment method details
            const methodDetails = document.getElementById(`${this.dataset.method}-details`);
            methodDetails.style.display = 'block';
            paymentDetails.style.display = 'block';

            // Enable confirm payment button
            confirmPaymentBtn.disabled = false;
        });
    });

    confirmPaymentBtn.addEventListener('click', function() {
        // Here you would typically send a request to update the order status
        alert('Payment confirmed! Order will be processed soon.');
        window.location.href = '{% url "order_history" %}';
    });
});
</script>
{% endblock %}